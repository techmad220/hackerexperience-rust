<!DOCTYPE html>
<html>
<head>
    <title>Test Login Flow</title>
</head>
<body>
    <h1>Test Login Flow</h1>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="clearStorage()">Clear Storage</button>
    <button onclick="checkStorage()">Check Storage</button>
    <div id="result"></div>

    <script>
        async function testLogin() {
            const result = document.getElementById('result');

            try {
                // Login
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'changeme_secure'
                    })
                });

                const loginData = await loginResponse.json();

                if (loginData.success) {
                    // Cookie-based token; store username only for UI
                    try { localStorage.setItem('username', loginData.user.username); } catch (_) {}

                    result.innerHTML = `
                        <p style="color: green;">✅ Login successful!</p>
                        <p>Authenticated (cookie set)</p>
                        <p>Username: ${loginData.user.username}</p>
                        <p>Redirecting to /game in 3 seconds...</p>
                    `;

                    setTimeout(() => {
                        window.location.href = '/game';
                    }, 3000);
                } else {
                    result.innerHTML = `<p style="color: red;">❌ Login failed: ${loginData.error}</p>`;
                }
            } catch (error) {
                result.innerHTML = `<p style="color: red;">❌ Error: ${error}</p>`;
            }
        }

        function clearStorage() {
            try { localStorage.removeItem('username'); } catch (_) {}
            document.getElementById('result').innerHTML = '<p>✅ Local data cleared</p>';
        }

        function checkStorage() {
            const username = localStorage.getItem('username');
            document.getElementById('result').innerHTML = `
                <p>Token: (httpOnly cookie)</p>
                <p>Username: ${username || 'Not set'}</p>
            `;
        }
    </script>
</body>
</html>
